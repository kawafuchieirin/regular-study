# セッション３: 実行環境の作成とベースイメージの利用

このセッションでは、Dockerを使って実行環境を作成し、ベースイメージを利用してコンテナ上でプログラムを実行します。

## 学習内容

1. **実行環境を作成する**: Dockerfileを使用してコンテナの実行環境を定義
2. **ベースイメージの利用**: 既存のベースイメージ（python:3.11-slim）を利用
3. **コンテナ上でのプログラム実行**: Pythonプログラムをコンテナ内で実行
4. **ホストとコンテナの関係の確認**: ホストとコンテナの違いを理解

## ファイル構成

```
セッション３/
├── Dockerfile      # コンテナの定義ファイル
├── hello.py        # 実行するPythonプログラム
└── README.md       # このファイル
```

## 手順

### 1. Dockerイメージをビルドする

```bash
docker build -t session3-hello .
```

このコマンドで：
- `-t session3-hello`: イメージに `session3-hello` という名前（タグ）を付けます
- `.`: カレントディレクトリ（セッション３のフォルダ）をビルドコンテキストとして使用

### 2. コンテナを実行する

```bash
docker run session3-hello
```

このコマンドで：
- `session3-hello` イメージからコンテナを作成して実行
- `hello.py` がコンテナ内で実行され、結果が表示されます

### 3. ホストとコンテナの関係を確認する

#### ホスト側で実行してみる

```bash
# ホスト側で直接実行
python3 hello.py
```

#### コンテナ側で実行してみる

```bash
# コンテナ側で実行
docker run session3-hello
```

#### コンテナ内に入って確認する

```bash
# コンテナをインタラクティブモードで起動
docker run -it session3-hello /bin/bash

# コンテナ内で以下を実行
python hello.py
ls -la
pwd
exit
```

## Dockerfileの説明

```dockerfile
FROM python:3.11-slim
```
- **ベースイメージ**: `python:3.11-slim` を使用
- これは公式のPython 3.11の軽量版イメージです
- ベースイメージを利用することで、Python環境を一から構築する必要がありません

```dockerfile
WORKDIR /app
```
- コンテナ内の作業ディレクトリを `/app` に設定
- 以降のコマンドはこのディレクトリで実行されます

```dockerfile
COPY hello.py .
```
- ホストの `hello.py` をコンテナの `/app` にコピー
- これにより、ホストのファイルがコンテナ内で利用可能になります

```dockerfile
CMD ["python", "hello.py"]
```
- コンテナ起動時に `python hello.py` を実行
- `CMD` はデフォルトの実行コマンドを指定します

## ホストとコンテナの関係

### ホスト（Host）
- Dockerを実行しているマシン（あなたのPC）
- ファイルシステム、ネットワーク、プロセスなどが直接アクセス可能

### コンテナ（Container）
- ホストから分離された実行環境
- 独自のファイルシステム、ネットワーク、プロセス空間を持つ
- ホストのファイルにアクセスするには、明示的にマウントする必要がある

### 重要なポイント

1. **ファイルのコピー**: `COPY` コマンドでホストのファイルをコンテナにコピー
2. **分離された環境**: コンテナ内の変更はホストに影響しない（ボリュームマウントしない限り）
3. **ベースイメージ**: 既存のイメージを利用することで、環境構築を簡略化

## 補足コマンド

### イメージの確認

```bash
# ビルドしたイメージを確認
docker images

# 特定のイメージの詳細を確認
docker inspect session3-hello
```

### コンテナの確認

```bash
# 実行中のコンテナを確認
docker ps

# すべてのコンテナ（停止中も含む）を確認
docker ps -a
```

### クリーンアップ

```bash
# コンテナを削除
docker rm <container_id>

# イメージを削除
docker rmi session3-hello
```

